@using SkillBuilder.Data
@using Microsoft.EntityFrameworkCore
@inject AppDbContext _context
@model SkillBuilder.Models.ViewModels.ArtisanProfileViewModel

@{
    // Get the current user from the DB
    var userId = User.FindFirst("UserId")?.Value;
    SkillBuilder.Models.User? user = null;
    bool isApproved = false;
    bool isVerified = false;
    bool isDeactivated = false;

    if (!string.IsNullOrEmpty(userId))
    {
        user = await _context.Users
            .Include(u => u.Artisan)
            .FirstOrDefaultAsync(u => u.Id == userId);

        if (user != null)
        {
            isVerified = user.IsVerified;
            isDeactivated = user.IsDeactivated;

            if (user.Artisan != null)
            {
                isApproved = user.Artisan.IsApproved;
            }
        }
    }
}

<style>
    .artisan-courses-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .artisan-courses-heading {
        font-size: 1.8rem;
        font-weight: bold;
        color: #344AEA;
        margin-bottom: 1rem;
    }

    .artisan-courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 1.5rem;
    }

    .artisan-course-card {
        background: #fff;
        border: 1px solid #d3d3d3;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: box-shadow 0.2s ease;
        min-height: 320px; /* makes the card taller */
    }

        .artisan-course-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

    .artisan-course-image-wrapper {
        background: #f0f0f5;
        height: 180px; /* was 150px */
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .artisan-course-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .artisan-course-content {
        padding: 1rem;
    }

    .artisan-course-title {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #000;
    }

    .artisan-course-desc {
        font-size: 0.9rem;
        color: #555;
        line-height: 1.4;
    }

    .artisan-course-actions {
        display: flex;
        justify-content: space-between;
        padding: 1rem;
        gap: 0.5rem;
        margin-top: auto;
    }

    /* Primary button */
    .btn-primary {
        padding: 0.4rem 1rem; /* slimmer height */
        background: #344AEA;
        color: white;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s ease;
        display: inline-block; /* keeps button natural width */
    }

        .btn-primary:hover {
            background: #2c3fcf;
        }

    /* Outlined button */
    .btn-outline {
        padding: 0.4rem 1rem;
        border: 1px solid #344AEA;
        background: white;
        color: #344AEA;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s ease, color 0.2s ease;
    }

        .btn-outline:hover {
            background: #f3f4ff;
        }

    /* Remove the full-width override */
    .btn-primary.full-width {
        width: auto;
    }

    .create-card {
        align-items: center;
        text-align: center;
        padding: 1.5rem 1rem;
        justify-content: center;
        gap: 0.8rem;
    }

        .create-card .btn-primary {
            margin-top: 0.5rem;
        }

    .create-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #f0f0f5;
        color: #344AEA;
        font-size: 1.5rem;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 1rem;
    }
</style>

<div class="artisan-courses-section">
    <div class="artisan-courses-heading">Courses<br /><span style="font-size: 1rem; font-weight: 400; color: black;">This is your courses section where you can see the list of all courses you have created, here you can view reviews or edit courses..</span></div>

    <div class="artisan-courses-grid">
        @if (Model.Courses.Any())
        {
            @foreach (var course in Model.Courses)
            {
                <div class="artisan-course-card">
                    <div class="artisan-course-image-wrapper">
                        <img src="@course.ImageUrl" alt="@course.Title" class="artisan-course-image" />
                    </div>
                    <div class="artisan-course-content">
                        <h3 class="artisan-course-title">@course.Title</h3>
                        <p class="artisan-course-desc">@course.Overview</p>
                    </div>
                    <div class="artisan-course-actions">
                        <a href="/Courses?selectedCourse=@course.Link&tab=reviews" class="btn-outline" style="text-decoration: none;">
                            View Reviews
                        </a>

                        @if (isDeactivated)
                        {
                            <a class="btn-primary" style="text-decoration: none; background-color:#ccc; cursor:not-allowed; opacity:0.6; pointer-events:none;">
                                Edit (Account Deactivated)
                            </a>
                        }
                        else
                        {
                            <a href="/ArtisanActions/EditCourse/@course.Id" class="btn-primary" style="text-decoration: none;">
                                Edit
                            </a>
                        }
                    </div>
                </div>
            }

            <!-- Create New Course Card -->
            <div class="artisan-course-card create-card">
                <div class="create-icon">+</div>
                <h3 class="artisan-course-title">Create new course</h3>
                <p class="artisan-course-desc">
                    Share your knowledge and skills with students around the world.
                </p>

                @if (isDeactivated)
                {
                    <a class="btn-primary full-width" style="text-decoration: none; background-color:#ccc; cursor:not-allowed; opacity:0.6; pointer-events:none;">
                        Account is currently deactivated. Cannot create course.
                    </a>
                }
                else if (isApproved && isVerified)
                {
                    <a href="/ArtisanActions/CreateCourse" class="btn-primary full-width" style="text-decoration: none;">
                        + Create course
                    </a>
                }
                else
                {
                    <a class="btn-primary full-width" style="text-decoration: none; background-color:#ccc; cursor:not-allowed; opacity:0.6; pointer-events:none;">
                        + Create course (Pending Approval)
                    </a>
                }
            </div>
        }
        else
        {
            <!-- Empty State -->
            <div class="artisan-course-card create-card">
                <div class="create-icon">+</div>
                <h3 class="artisan-course-title">Create your first course</h3>
                <p class="artisan-course-desc">
                    Start sharing your expertise with learners worldwide.
                </p>

                @if (isDeactivated)
                {
                    <a class="btn-primary full-width" style="text-decoration: none; background-color:#ccc; cursor:not-allowed; opacity:0.6; pointer-events:none;">
                        Account is currently deactivated. Cannot create course.
                    </a>
                }
                else if (isApproved && isVerified)
                {
                    <a href="/ArtisanActions/CreateCourse" class="btn-primary full-width" style="text-decoration: none;">
                        + Create course
                    </a>
                }
                else
                {
                    <a class="btn-primary full-width" style="text-decoration: none; background-color:#ccc; cursor:not-allowed; opacity:0.6; pointer-events:none;">
                        + Create course (Pending Approval)
                    </a>
                }
            </div>
        }
    </div>
</div>